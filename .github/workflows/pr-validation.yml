name: Pull Request Validation

on:
    pull_request:
        branches:
            - master
            - main

jobs:
    validate-pr:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout ğŸ›ï¸
              uses: actions/checkout@v4

            - name: Setup pnpm ğŸ“¦
              uses: pnpm/action-setup@v3
              with:
                  version: 7

            - name: Setup Node.js ğŸ”§
              uses: actions/setup-node@v4
              with:
                  node-version: '18'
                  cache: 'pnpm'

            - name: Install Dependencies ğŸ“¦
              run: pnpm install --frozen-lockfile

            - name: Validate Apps ğŸ”
              run: pnpm run validate

            - name: Check Formatting ğŸ’…
              run: pnpm run formatter

            - name: Check for Modified Files ğŸ“
              run: |
                  if [ -n "$(git diff --name-only origin/${{ github.base_ref }}...HEAD -- 'public/v4/apps/*.yml')" ]; then
                    echo "Apps modified in this PR:"
                    git diff --name-only origin/${{ github.base_ref }}...HEAD -- 'public/v4/apps/*.yml'
                  fi

            - name: Check for Missing Logos ğŸ–¼ï¸
              run: |
                  for app in public/v4/apps/*.yml; do
                    appname=$(basename "$app" .yml)
                    if [ ! -f "public/v4/logos/${appname}.png" ]; then
                      echo "âŒ Missing logo for: $appname"
                      exit 1
                    fi
                  done
                  echo "âœ… All apps have logos"

            - name: Test Build ğŸ—ï¸
              run: pnpm run build
